<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="main.css" />
    <title>Document</title>
  </head>
  <body>
    <header class="header-main">
      <img class="header-main__logo" src="/assets/images/nasalogo.png" />
      <h1 class="header-main__title-text">NASA Image Search</h1>
    </header>
    <nav>
      <label for="search">Search</label>
      <input type="text" name="search" id="search" value="apollo 11" />
      <label for="search-desc">Description (optional)</label>
      <input
        type="text"
        name="search-desc"
        id="search-desc"
        value="moon landing"
      />
      <button id="button-search">Search</button>
    </nav>
    <main>
      <p id="msg-text" class="msg-text">&nbsp;</p>
      <div id="image-area"></div>
    </main>
    <footer>
      <p>NASA Image Search</p>
    </footer>
    <script>
      var xmlhttp = new XMLHttpRequest();

      var elemButtonSearch;
      var elemInputSearch;
      var elemInputSearchDesc;
      var imageAreaDiv;
      var elementTextMsg;

      window.onload = function() {
        var url = "/nasaimgsearch";
        imageAreaDiv = document.getElementById("image-area");
        elemButtonSearch = document.getElementById("button-search");
        elemInputSearch = document.getElementById("search");
        elemInputSearchDesc = document.getElementById("search-desc");
        elementTextMsg = document.getElementById("msg-text");

        elemButtonSearch.onclick = function() {
          elementTextMsg.innerHTML = "...searching...";

          xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == XMLHttpRequest.DONE) {
              if (xmlhttp.status == 200) {
                var imageUrlsList = JSON.parse(xmlhttp.responseText);
                elementTextMsg.innerHTML =
                  imageUrlsList.length + " images found.";
                imageUrlsList.forEach(function(thumb) {
                  var newImage = document.createElement("img");
                  const imgUrl = thumb.thumbnailLink;
                  newImage.setAttribute("src", imgUrl);
                  newImage.setAttribute("height", "100px");
                  newImage.className = "fewbahr2k";
                  imageAreaDiv.appendChild(newImage);
                });
              } else if (xmlhttp.status == 400) {
                imageAreaDiv.innerHTML = "Error 400!";
              } else {
                imageAreaDiv.innerHTML =
                  "Error: Something other than 200 returned!";
              }
            }
          };

          // @TODO: sanitize search text

          var params =
            "?search=" +
            elemInputSearch.value +
            "&searchDesc=" +
            elemInputSearchDesc.value;

          xmlhttp.open("GET", url + params, true);
          xmlhttp.send();
        };
      };
    </script>
  </body>
</html>
